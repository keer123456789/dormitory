<template>
  <page-layout :avatar="currUser.avatar">
    <a-card :bordered="false" style="width: 100%">
      <div>
        <a-select
          style="width: 120px"
          @change="handleProvinceChange"
        >
          <a-select-option v-for="province in provinceData" :key="province.value">
            {{ province.name }}
          </a-select-option>
        </a-select>
        <a-select
          v-model="secondCity"
          style="width: 120px"
          @change="floorChange"
        >
          <a-select-option v-for="city in cities" :key="city.value">
            {{ city.name }}
          </a-select-option>
        </a-select>
        <a-button type="primary" @click="doSearch"> 查看 </a-button>

        <a-select
          default-value="灭火器"
          style="width: 120px;margin-left: 30px"
          @change="handleChange"
        >
          <a-select-option value="灭火器"> 灭火器 </a-select-option>
          <a-select-option value="报警按钮"> 报警按钮 </a-select-option>
          <a-select-option value="电闸"> 电闸 </a-select-option>
          <a-select-option value="消防栓"> 消防栓 </a-select-option>
          <a-select-option value="应急灯"> 应急灯 </a-select-option>
        </a-select>
        <span>X:</span
        ><a-input-number
          id="inputNumber"
          v-model="mapX"
          :min="1"
          :max="100000"
        />
        <span>Y:</span
        ><a-input-number
          id="inputNumber"
          v-model="mapY"
          :min="1"
          :max="100000"
        />
        <a-button type="primary" @click="doAdd"> 添加 </a-button>
      </div>
    </a-card>
    <div
      ref="myChart"
      id="myChart"
      :style="{ width: '1616px', height: '500px' }"
    ></div>
  </page-layout>
</template>

<script>
import PageLayout from "@/layouts/PageLayout";
import { mapState } from "vuex";
import { request, METHOD } from "@/utils/request";
import { getMapData, object, getBuildData } from "@/services/dataSource";

export default {
  name: "WorkPlace",
  components: { PageLayout },
  i18n: require("./i18n"),
  data() {
    return {
      projects: [],
      loading: true,
      activities: [],
      teams: [],
      welcome: {
        timeFix: "",
        message: "",
      },
      provinceData: [],
      cityData: {},
      cities: [],
      secondCity: [],
      buildname: "一号楼",
      floorname: "一层",
      autoKey: 1,
      currentKey: undefined,
      currentValue: undefined,
      modalVisible: false,
      firstData: [{ key: 0, name: "请选择" }],
      testMapImage: "",
      student: [],
      floor: [{ name: "楼层", floorNum: "4号楼3层", x: 700, y: 260 }],
      bjan: [],
      dz: [],
      mhq: [],
      xfs: [],
      yjd: [],
      mapX: 0,
      mapY: 0,
      objectForAdd: "灭火器",
      block_name: "",
      floor_name:""
    };
  },
  computed: {
    ...mapState("account", { currUser: "user" }),
    ...mapState("setting", ["lang"]),
  },
  created() {
    request("/user/welcome", METHOD.GET).then(
      (res) => (this.welcome = res.data)
    );
  },
  mounted() {
    getBuildData().then((result) => {
      this.provinceData = result.data.data.blocks;
      this.cityData = result.data.data.floors;
    });
    this.getMap({
      blockId: "123",
      floorId: "111",
    });
  },
  methods: {
    handleProvinceChange(value) {
      this.cities = this.cityData[value];
      // this.secondCity = cityData[value][0].name;
      for(let i in this.provinceData){
        if(this.provinceData[i].value == value){
          this.block_name = this.provinceData[i].name;
        }
      }
      this.buildname = value;
    },
    floorChange(value) {
      console.log(this.cityData[value]);
      for(let i in this.cityData[value]){
        if(this.cityData[value][i].value == value){
          this.floor_name = this.cityData[value][i].name;
        }
      }
      this.floorname = value;
    },
    doSearch() {
      this.getMap({
        blockId: this.buildname,
        floorId: this.floorname,
      });
    },
    getMap(params) {
      getMapData(params).then((result) => {
        var mapImage = "";
        this.testMapImage = result.data.map;
        this.student = result.data.student;
        this.floor[0].floorNum = this.block_name + " " + this.floor_name;
        for (let i in result.data.object) {
          switch (result.data.object[i].name) {
            case "灭火器":
              this.mhq.push(result.data.object[i]);
              break;
            case "报警按钮":
              this.bjan.push(result.data.object[i]);
              break;
            case "电闸":
              this.dz.push(result.data.object[i]);
              break;
            case "消防栓":
              this.xfs.push(result.data.object[i]);
              break;
            case "应急灯":
              this.yjd.push(result.data.object[i]);
              break;
            default:
              break;
          }
        }
        this.object = result.data.object;
        mapImage = this.testMapImage;
        this.drawLine(mapImage);
      });
    },
    drawLine(mapImage) {
      let svgXML = `
            <svg width="1616" height="500" xmlns="http://www.w3.org/2000/svg">
                <rect x="0" y="0" width="1616" height="500" fill="rgba(255,255,255,0.5)"/>
            </svg>
        `;
      this.$echarts.registerMap("mymap", {
        svg: svgXML,
      });
      /* 配置项
       * 1、geo组件：渲染已注册地图
       * 2、series.custom图表：渲染自定义的图片地图
       * 3、visualMap组件和series.heatmap图表：渲染热力图
       */
      let option = {
        backgroundColor: "rgba(0,0,0,1)",
        geo: {
          map: "mymap",
          roam: false,
          top: 0,
          bottom: 0,
          left: 0,
          right: 0,
        },
        // 与热力图heatmap搭配使用
        visualMap: {
          type: "continuous",
          show: false,
          min: 0,
          max: 100,
          inRange: {
            color: ["#00f", "#ff0", "#f00"],
          },
        },
        series: [
          {
            type: "custom",
            name: "自定义图片地图",
            coordinateSystem: "geo",
            animation: false,
            renderItem: function (params, api) {
              let pos = api.coord([params.coordSys.x, params.coordSys.y]);
              let size = api.size([
                params.coordSys.width,
                params.coordSys.height,
              ]);

              let item = {
                type: "image",
                style: {
                  image: mapImage,
                  x: pos[0],
                  y: pos[1],
                  width: size[0],
                  height: size[1],
                },
              };
              return item;
            },
            data: [0],
          },
          {
            //系列名称
            name: "学生坐标",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 13;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#0976e6",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
          {
            //系列名称
            name: "楼层",
            symbol: "pin",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              fontSize: 30,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 20;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#1db337",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
          {
            //系列名称
            name: "灭火器",
            symbol:
              "path://M238.48617553710938,930.0960693359375l0,41.735107421875c0,11.92425537109375,4.47161865234375,20.86749267578125,11.924301147460938,29.81072998046875c8.943222045898438,8.9432373046875,17.886459350585938,11.92431640625,29.810775756835938,11.92431640625l332.39007568359375,0c11.92431640625,0,20.8675537109375,-4.47161865234375,29.810791015625,-11.92431640625c8.9432373046875,-7.45269775390625,11.92431640625,-17.886474609375,11.92431640625,-29.81072998046875l0,-41.735107421875L238.48617553710938,930.0960693359375ZM639.4410400390625,383.06842041015625L253.3915557861328,383.06842041015625c-8.9432373046875,32.791839599609375,-14.905380249023438,68.56475830078125,-14.905380249023438,95.39447021484375l0,392.01165771484375l415.8602600097656,0L654.346435546875,479.95343017578125c0,-28.32025146484375,-4.47161865234375,-64.09317016601562,-14.9053955078125,-96.885009765625Z M770.6084594726562,557.46142578125c-11.92431640625,-14.9053955078125,-22.35809326171875,-31.30133056640625,-29.810791015625,-49.187774658203125c-22.35809326171875,-46.206695556640625,-28.32025146484375,-98.37554931640625,-31.30133056640625,-149.05386352539062c-1.49053955078125,-26.829681396484375,-1.49053955078125,-55.149932861328125,0,-81.9796142578125c1.49053955078125,-23.848617553710938,5.962158203125,-47.697235107421875,4.47161865234375,-73.03639221191406c0,-25.339157104492188,-4.47161865234375,-49.187774658203125,-17.88641357421875,-70.05531311035156c-13.41485595703125,-19.376998901367188,-34.28240966796875,-35.772918701171875,-56.6405029296875,-43.225616455078125c-37.263427734375,-11.924308776855469,-76.0174560546875,-10.433769226074219,-113.28094482421875,0L526.1600952148438,89.43231201171875c0,-5.962150573730469,-4.47161865234375,-8.943229675292969,-8.9432373046875,-8.943229675292969l-8.943206787109375,0c-10.43377685546875,-28.320232391357422,-37.263458251953125,-49.18777275085449,-68.56475830078125,-49.18777275085449c-28.32025146484375,0,-52.168853759765625,16.395925521850586,-65.58370971679688,38.75400352478027c-41.735076904296875,0,-122.22416687011719,0,-183.33624267578125,-2.9810791015625c-11.92431640625,-1.49053955078125,-11.92431640625,0,-17.886459350585938,5.962158203125c-5.962158203125,7.452690124511719,-5.962158203125,32.791847229003906,-1.49053955078125,37.263458251953125c1.49053955078125,1.49053955078125,4.4716033935546875,2.9810791015625,7.4526824951171875,2.9810791015625c0,0,28.320236206054688,-10.433769226074219,166.94033813476562,-10.433769226074219c4.471588134765625,0,8.943206787109375,5.962158203125,1.49053955078125,10.433769226074219c-23.8486328125,14.9053955078125,-99.86610412597656,43.225616455078125,-125.20526123046875,55.149932861328125c-5.9621429443359375,2.9810791015625,-10.433761596679688,7.4526824951171875,-11.924301147460938,11.924301147460938c-1.49053955078125,5.962158203125,-1.49053955078125,14.9053955078125,-2.9810791015625,22.358078002929688c0,5.962158203125,7.45269775390625,10.43377685546875,13.41485595703125,7.45269775390625c32.791839599609375,-17.886459350585938,81.97962951660156,-50.678314208984375,146.07276916503906,-73.03639221191406c1.49053955078125,0,4.47161865234375,-1.49053955078125,5.962158203125,-1.49053955078125c2.9810791015625,7.45269775390625,7.45269775390625,13.41485595703125,11.92431640625,17.886459350585938l0,89.43232727050781l-1.49053955078125,0c-43.225616455078125,13.414825439453125,-77.50802612304688,43.225616455078125,-104.33770751953125,80.48907470703125c-2.9810791015625,4.47161865234375,-7.45269775390625,10.43377685546875,-10.43377685546875,16.39593505859375L623.0451049804688,339.8428039550781c-4.47161865234375,-8.9432373046875,-10.43377685546875,-17.886474609375,-16.39593505859375,-25.33917236328125c-26.82965087890625,-32.791839599609375,-65.58367919921875,-53.659393310546875,-116.26199340820312,-71.54583740234375l0,-87.94178771972656c4.47161865234375,-4.4716033935546875,7.45269775390625,-8.943222045898438,10.43377685546875,-13.414840698242188l14.905364990234375,0c5.962158203125,0,8.9432373046875,-4.47161865234375,8.9432373046875,-8.9432373046875l0,-11.924301147460938c31.30133056640625,-8.9432373046875,65.583740234375,-13.414848327636719,95.39447021484375,-4.47161865234375c17.886474609375,4.47161865234375,34.28240966796875,13.414840698242188,46.20672607421875,26.829696655273438c11.92431640625,14.905380249023438,16.39593505859375,32.791839599609375,17.886474609375,50.678314208984375c1.49053955078125,23.848617553710938,-1.49053955078125,47.697235107421875,-4.47161865234375,71.54583740234375c-2.9810791015625,26.8297119140625,-1.49053955078125,53.659393310546875,-1.49053955078125,81.97964477539062c1.49053955078125,52.1688232421875,5.962158203125,108.80929565429688,26.82965087890625,157.9970703125c10.43377685546875,25.339141845703125,25.33917236328125,49.187774658203125,41.735107421875,71.54586791992188l-5.962158203125,5.962158203125l-16.39593505859375,16.39593505859375l131.16741943359375,165.44976806640625l93.9039306640625,-86.45123291015625l-156.506591796875,-143.09173583984375l-22.3580322265625,22.35809326171875Z",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              fontSize: 15,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 20;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#ED1330",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
          {
            //系列名称
            name: "报警按钮",
            symbol:
              "path://M175.78700256347656,919.8930053710938L175.78700256347656,604.1599731445312c0,-189.43997192382812,153.59999084472656,-343.03997802734375,343.04002380371094,-343.03997802734375s343.03997802734375,153.60000610351562,343.03997802734375,343.03997802734375l0,315.7330322265625l117.760009765625,0c23.89300537109375,0,44.37298583984375,20.47998046875,44.37298583984375,44.37298583984375s-20.47998046875,44.37298583984375,-44.37298583984375,44.37298583984375L46.08000183105469,1008.6389770507812c-23.893001556396484,0,-44.37300181388855,-20.47998046875,-44.37300181388855,-44.37298583984375s20.480000257492065,-44.37298583984375,44.37300181388855,-44.37298583984375l129.70700073242188,0Zm368.63999938964844,-520.5330200195312l-168.95999145507812,278.18701171875l134.82699584960938,0L476.1610107421875,885.760009765625l168.9599609375,-278.18701171875L510.29400634765625,607.572998046875l34.13299560546875,-208.2130126953125ZM802.1329956054688,93.86699676513672c15.3599853515625,8.533004760742188,20.47998046875,29.01300048828125,11.947021484375,46.08000946044922L752.6400146484375,245.75999450683594l-58.02703857421875,-32.427001953125l61.44000244140625,-105.81299591064453c10.24005126953125,-17.066993713378906,30.72003173828125,-22.186996459960938,46.08001708984375,-13.652999877929688ZM518.8270263671875,15.359999656677246c20.47998046875,0,35.8399658203125,15.359999656677246,35.8399658203125,34.13300037384033L554.6669921875,168.9600067138672l-71.67999267578125,0L482.98699951171875,49.49300003051758c0,-18.773000717163086,15.3599853515625,-34.13300037384033,35.84002685546875,-34.13300037384033ZM235.52000427246094,93.86699676513672c15.360000610351562,-8.532997131347656,35.83998107910156,-3.412994384765625,44.37300109863281,11.947006225585938l61.44000244140625,105.81299591064453l-58.027008056640625,32.427001953125l-61.44000244140625,-105.81300354003906c-8.533004760742188,-15.360000610351562,-3.412994384765625,-34.13299560546875,13.652999877929688,-44.37300109863281ZM27.30699920654297,302.0799865722656c8.533000946044922,-15.3599853515625,29.01300048828125,-22.186981201171875,44.37300109863281,-11.946990966796875l105.81299591064453,61.44000244140625l-32.427001953125,58.027008056640625l-105.81299591064453,-61.44000244140625c-15.35999870300293,-8.532989501953125,-20.479997634887695,-29.01300048828125,-11.946998596191406,-46.08001708984375Zm983.0399856567383,0c8.53302001953125,15.360015869140625,3.41302490234375,35.84002685546875,-11.94696044921875,46.08001708984375L892.5869750976562,409.6000061035156l-32.427001953125,-58.027008056640625l105.81304931640625,-61.44000244140625c15.3599853515625,-8.532989501953125,35.8399658203125,-3.412994384765625,44.37298583984375,11.946990966796875Z",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              fontSize: 15,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 20;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#fa9c11",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
          {
            //系列名称
            name: "电闸",
            symbol:
              "path://M779.9398193359375,119.82848358154297L422.70721435546875,119.82848358154297l-178.62657165527344,402.16577911376953l154.23487854003906,0l-109.5679931640625,397.23004150390625l446.5663757324219,-479.0681457519531l-163.778564453125,0L779.9398193359375,119.82848358154297Zm0,0",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              fontSize: 15,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 20;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#868f98",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
          {
            //系列名称
            name: "消防栓",
            symbol:
              "path://M770.9400024414062,903L709,903L709,646l53.94000244140625,0A27.36,27.36,0,0,0,790,618.6400146484375L790,477.8599853515625A26.93,26.93,0,0,0,762.9400024414062,451L709,451l0,-79.44000244140625a18,18,0,0,0,7.70001220703125,-3.55999755859375l34.489990234375,0a27,27,0,1,0,0,-54l-26.1199951171875,0a218.18,218.18,0,0,0,-125.28997802734375,-154c0.0699462890625,-0.8000030517578125,0.219970703125,-1.55999755859375,0.219970703125,-2.3800048828125L600,94a27.18,27.18,0,0,0,-27.21002197265625,-27L451.20001220703125,67A27.17,27.17,0,0,0,424,94l0,63.660003662109375c0,0.8199920654296875,0.1400146484375,1.6399993896484375,0.220001220703125,2.44000244140625A217.52,217.52,0,0,0,298.92999267578125,314l-26.1199951171875,0a27,27,0,0,0,0,54l34.489990234375,0a18,18,0,0,0,7.70001220703125,3.55999755859375L315,451l-53.94000244140625,0A26.93,26.93,0,0,0,234,477.8599853515625l0,140.780029296875A27.36,27.36,0,0,0,261.05999755859375,646L315,646l0,257l-61.94000244140625,0a27,27,0,0,0,0,54l517.8800048828125,0a27,27,0,0,0,0,-54ZM736,505l0,87l-27,0l0,-87ZM478,121l68,0l0,23.339996337890625a221.24,221.24,0,0,0,-68,0Zm-77.739990234375,118.6300048828125A163.88,163.88,0,0,1,669.4500122070312,314l-314.9000244140625,0a164.46,164.46,0,0,1,45.71002197265625,-74.3699951171875ZM288,592l0,-87l27,0l0,87Zm81,311L369,368l286,0l0,535Z M456,421.8999938964844a27,27,0,0,0,-27,27L429,824a27,27,0,0,0,54,0L483,448.8999938964844a27,27,0,0,0,-27,-27ZM568,421.8999938964844a27,27,0,0,0,-27,27L541,824a27,27,0,0,0,54,0L595,448.8999938964844a27,27,0,0,0,-27,-27Z",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              fontSize: 15,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 20;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#08c2f4",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
          {
            //系列名称
            name: "应急灯",
            symbol:
              "path://M290.3039855957031,463.3599853515625L276.4800109863281,463.3599853515625l0,-19.45599365234375L214.5279998779297,443.90399169921875l0,19.45599365234375l-13.311996459960938,0l0,28.672027587890625l13.311996459960938,0l0,28.160003662109375L276.4800109863281,520.1920166015625l0,-28.160003662109375l13.823974609375,0l0,-28.672027587890625Z M245.75999450683594,455.67999267578125a189.44,189.44,0,1,1,191.4879913330078,-189.44000244140625A190.464,190.464,0,0,1,245.75999450683594,455.67999267578125Zm0,-353.27999114990234a165.376,165.376,0,1,0,167.4239959716797,163.8399887084961A166.912,166.912,0,0,0,245.75999450683594,102.4000015258789Z M141.31199645996094,153.60000610351562l-10.751998901367188,10.751998901367188l66.04800415039062,53.75999450683594ZM186.8800048828125,123.90399932861328l-13.824005126953125,6.144004821777344L216.5760040283203,204.8000030517578ZM162.8159942626953,136.19200134277344l-12.287994384765625,8.703994750976562L204.8000030517578,210.4320068359375ZM97.27999877929688,219.6479949951172q0,7.167999267578125,-4.096000671386719,14.33599853515625l85.5040054321289,14.848007202148438ZM122.87999725341797,172.03199768066406l-8.703994750976562,12.288009643554688l74.75199127197266,43.00799560546875ZM108.03199768066406,194.55999755859375Q102.4000015258789,201.21600341796875,102.4000015258789,208.38400268554688l81.40799713134766,29.183990478515625ZM212.47999572753906,116.2239990234375l-14.847991943359375,4.096000671386719l29.695999145507812,80.38399505615234ZM239.61599731445312,112.63999938964844l-14.847991943359375,0l14.847991943359375,84.47999572753906ZM93.69599914550781,299.00799560546875q0,7.167999267578125,4.096000671386719,14.33599853515625l81.40799713134766,-29.183990478515625ZM150.5279998779297,388.09600830078125l12.287994384765625,8.7039794921875L204.8000030517578,322.55999755859375ZM173.05599975585938,402.4320068359375l13.824005126953125,7.167999267578125l29.695999145507812,-80.38400268554688ZM130.55999755859375,369.66400146484375l10.751998901367188,10.751983642578125l55.29600524902344,-65.53598022460938ZM198.1439971923828,412.6719970703125l14.848007202148438,4.09600830078125l14.847991943359375,-84.48001098632812ZM114.1760025024414,348.1600036621094l8.703994750976562,10.239990234375l66.0479965209961,-51.199981689453125ZM91.64800262451172,245.75999450683594l0,14.848007202148438l84.99199676513672,0ZM90.11199951171875,272.3840026855469l0,14.847991943359375l84.99200439453125,-14.847991943359375ZM266.239990234375,417.7919921875l-14.847991943359375,-83.45599365234375l0,86.0159912109375l14.847991943359375,0ZM292.864013671875,409.6000061035156l-29.18402099609375,-77.31201171875l14.8480224609375,83.45599365234375l14.33599853515625,-3.583984375ZM317.44000244140625,401.4079895019531l-42.496002197265625,-73.21600341796875L304.12799072265625,409.6000061035156l13.824005126953125,-6.144012451171875ZM339.9679870605469,387.0719909667969L285.1839904785156,322.55999755859375l43.00799560546875,73.21600341796875l12.28802490234375,-8.704010009765625ZM358.3999938964844,369.1520080566406L294.3999938964844,314.8800048828125l54.78399658203125,64.51199340820312l10.240020751953125,-10.239990234375ZM376.32000732421875,347.64801025390625L302.0799865722656,307.20001220703125l65.5360107421875,51.199981689453125l8.1920166015625,-11.7760009765625ZM388.6080017089844,324.09600830078125L307.20001220703125,295.42401123046875l74.239990234375,42.496002197265625q3.583984375,-6.656005859375,6.144012451171875,-13.31201171875ZM396.79998779296875,299.00799560546875L312.32000732421875,284.1600036621094l80.38400268554688,29.183990478515625q0,-7.167999267578125,3.583984375,-14.33599853515625ZM399.87200927734375,272.3840026855469L314.3680114746094,272.3840026855469l84.47998046875,14.847991943359375l0,-14.847991943359375ZM398.8479919433594,245.75999450683594l-84.47998046875,14.848007202148438l86.52798461914062,0L400.89599609375,245.75999450683594ZM392.7040100097656,219.6479949951172l-80.38400268554688,29.184005737304688l84.47998046875,-14.848007202148438q0,-7.167999267578125,-4.095977783203125,-14.33599853515625ZM382.4639892578125,195.07200622558594L307.20001220703125,237.5679931640625l80.38400268554688,-29.183990478515625l-6.144012451171875,-13.311996459960938ZM367.6159973144531,173.05599975585938L302.0799865722656,227.3280029296875l74.24002075195312,-42.496002197265625l-7.67999267578125,-12.800003051757812ZM349.1839904785156,153.60000610351562L294.3999938964844,218.11199951171875L358.3999938964844,163.83999633789062L350.2080078125,153.60000610351562ZM328.1919860839844,137.21600341796875l-43.00799560546875,73.21600341796875l54.78399658203125,-64.51200866699219l-12.287994384765625,-8.192001342773438ZM304.12799072265625,124.9280014038086L274.9440002441406,204.8000030517578l42.496002197265625,-73.72799682617188l-13.31201171875,-6.144004821777344ZM278.52801513671875,117.24800109863281l-14.8480224609375,83.45599365234375l29.18402099609375,-79.35999298095703l-14.33599853515625,-3.5839996337890625ZM266.75201416015625,114.1760025024414l-14.848007202148438,0l0,83.9679946899414l14.335983276367188,-82.94400024414062ZM239.61599731445312,418.8160095214844L239.61599731445312,334.33599853515625l-14.847991943359375,84.48001098632812l14.847991943359375,0ZM102.4000015258789,324.6080017089844q3.0719985961914062,7.167999267578125,6.1439971923828125,13.31201171875l75.26399993896484,-43.008026123046875ZM224.25599670410156,418.8160095214844l0.5120086669921875,0M186.8800048828125,408.57598876953125l0,0.51202392578125M198.1439971923828,413.1839904785156l0,-0.511993408203125M162.8159942626953,396.2879943847656l0,0.511993408203125M150.01600646972656,388.09600830078125l0.511993408203125,0M224.76800537109375,114.1760025024414l-0.5120086669921875,-0.5120010375976562M212.47999572753906,115.71199798583984l0,0.5120010375976562M150.5279998779297,144.89599609375l-0.511993408203125,0M173.05599975585938,130.55999755859375l0,-0.511993408203125M245.75999450683594,210.4320068359375A55.808,55.808,0,1,0,302.0799865722656,266.239990234375a56.32,56.32,0,0,0,-56.31999206542969,-55.8079833984375Zm17.919998168945312,73.21600341796875l-35.839996337890625,0l0,-34.816009521484375l35.3280029296875,0ZM828.927978515625,463.3599853515625l-13.823974609375,0l0,-19.45599365234375l-61.9520263671875,0l0,19.45599365234375l-13.31195068359375,0l0,28.672027587890625l13.31195068359375,0l0,28.160003662109375l61.9520263671875,0l0,-28.160003662109375l13.823974609375,0l0,-28.672027587890625Z M784.3839721679688,455.67999267578125a189.44,189.44,0,1,1,191.488037109375,-189.44000244140625a190.464,190.464,0,0,1,-191.488037109375,189.44000244140625Zm0,-354.8159942626953a165.376,165.376,0,1,0,167.42401123046875,165.37599182128906A166.912,166.912,0,0,0,784.3839721679688,102.4000015258789Z M679.9359741210938,153.60000610351562l-10.751953125,10.751998901367188l66.0479736328125,54.78399658203125ZM725.5040283203125,123.90399932861328l-13.82403564453125,6.144004821777344l43.52001953125,74.75199890136719ZM701.4400024414062,136.19200134277344l-12.28802490234375,8.703994750976562l55.80804443359375,65.5360107421875ZM635.9039916992188,219.6479949951172q0,7.167999267578125,-4.09600830078125,14.33599853515625l84.99200439453125,14.848007202148438ZM661.5040283203125,172.03199768066406l-8.70404052734375,12.288009643554688l74.75201416015625,43.00799560546875ZM646.656005859375,194.55999755859375q-3.583984375,6.656005859375,-6.14398193359375,13.311996459960938l81.407958984375,29.184005737304688ZM751.10400390625,116.2239990234375l-14.8480224609375,4.096000671386719l31.7440185546875,80.38399505615234ZM778.239990234375,112.63999938964844l-14.84796142578125,0l14.84796142578125,84.47999572753906ZM632.3200073242188,299.00799560546875q0,7.167999267578125,4.09600830078125,14.33599853515625L716.7999877929688,284.1600036621094ZM689.1519775390625,388.09600830078125l12.28802490234375,8.7039794921875l43.00799560546875,-74.239990234375ZM711.6799926757812,402.4320068359375l13.82403564453125,6.14398193359375l29.69598388671875,-80.38400268554688ZM669.1840209960938,369.66400146484375l10.751953125,10.751983642578125l55.80804443359375,-65.53598022460938ZM736.7680053710938,412.6719970703125l14.8480224609375,4.09600830078125l16.38397216796875,-84.48001098632812ZM652.7999877929688,348.1600036621094l8.70404052734375,12.287994384765625L727.552001953125,307.20001220703125ZM630.27197265625,245.75999450683594l0,14.848007202148438L716.7999877929688,260.6080017089844ZM628.7360229492188,272.3840026855469l0,14.847991943359375L716.7999877929688,272.3840026855469ZM804.864013671875,417.7919921875l-14.8480224609375,-83.45599365234375l0,86.0159912109375l14.8480224609375,0ZM831.4879760742188,409.6000061035156l-29.1839599609375,-79.36001586914062l16.89599609375,85.50399780273438l14.33599853515625,-3.583984375ZM856.0640258789062,401.4079895019531l-43.00799560546875,-73.21600341796875l29.69598388671875,81.40802001953125l13.823974609375,-6.144012451171875ZM878.5919799804688,387.0719909667969L823.8079833984375,322.55999755859375l43.00799560546875,73.21600341796875l12.28802490234375,-8.704010009765625ZM898.5599975585938,369.1520080566406l-65.5360107421875,-54.272003173828125l54.78399658203125,65.02398681640625l10.239990234375,-10.239990234375ZM914.9439697265625,347.64801025390625L840.7039794921875,307.20001220703125l65.5360107421875,51.199981689453125l8.1920166015625,-11.7760009765625ZM927.2319946289062,324.09600830078125l-80.38397216796875,-29.18402099609375l74.751953125,42.496002197265625q3.58404541015625,-6.655975341796875,6.14404296875,-13.311981201171875ZM935.4240112304688,299.00799560546875l-84.48004150390625,-14.847991943359375l80.384033203125,29.183990478515625q0,-7.167999267578125,3.583984375,-14.33599853515625ZM938.4959716796875,272.3840026855469l-85.50396728515625,0l84.47998046875,14.847991943359375l0,-14.847991943359375ZM937.4719848632812,245.75999450683594l-84.47998046875,14.848007202148438l86.52801513671875,0L939.52001953125,245.75999450683594ZM931.3280029296875,219.6479949951172l-80.384033203125,29.184005737304688l84.48004150390625,-14.848007202148438q0,-7.167999267578125,-4.09600830078125,-14.33599853515625ZM921.5999755859375,195.07200622558594l-74.239990234375,42.49598693847656l80.384033203125,-29.183990478515625l-6.14404296875,-13.311996459960938ZM906.239990234375,173.05599975585938l-65.5360107421875,54.272003173828125l74.239990234375,-42.496002197265625l-8.7039794921875,-11.7760009765625ZM887.8079833984375,153.60000610351562l-54.78399658203125,64.51199340820312l65.5360107421875,-54.272003173828125l-9.72802734375,-10.239990234375ZM866.8159790039062,137.21600341796875l-43.00799560546875,73.21600341796875l54.78399658203125,-65.02400207519531l-12.2879638671875,-8.192001342773438ZM842.7520141601562,124.9280014038086L813.5679931640625,204.8000030517578l43.00799560546875,-73.21600341796875l-13.31201171875,-6.1439971923828125ZM819.2000122070312,117.24800109863281l-14.8480224609375,83.45599365234375l29.18402099609375,-79.35999298095703l-14.33599853515625,-5.120002746582031ZM805.3759765625,114.1760025024414l-14.84796142578125,0l0,83.9679946899414l14.84796142578125,-83.45599365234375ZM778.239990234375,418.8160095214844L778.239990234375,334.33599853515625l-14.84796142578125,84.48001098632812l14.84796142578125,0ZM640,324.6080017089844q3.072021484375,7.167999267578125,6.14398193359375,13.31201171875l75.2640380859375,-43.008026123046875ZM762.8800048828125,418.8160095214844l0.51202392578125,0M725.5040283203125,408.57598876953125l0,0.51202392578125M736.7680053710938,413.1839904785156l0,-0.511993408203125M701.4400024414062,396.2879943847656l0,0.511993408203125M688.6400146484375,388.09600830078125l0.511962890625,0M763.3920288085938,114.1760025024414l-0.51202392578125,-0.5120010375976562M751.10400390625,115.71199798583984l0,0.5120010375976562M689.1519775390625,144.89599609375l-0.511962890625,0M711.6799926757812,130.55999755859375l0,-0.511993408203125M784.3839721679688,210.4320068359375a55.808,55.808,0,1,0,56.32000732421875,55.8079833984375a56.32,56.32,0,0,0,-56.32000732421875,-55.8079833984375Zm17.9200439453125,73.21600341796875L768,283.64801025390625l0,-34.816009521484375l35.3280029296875,0ZM93.18399810791016,502.78399658203125a30.72,30.72,0,0,0,-30.71999740600586,30.72003173828125l0,382.9759521484375a30.72,30.72,0,0,0,30.71999740600586,30.72003173828125L936.9600219726562,947.2000122070312a30.72,30.72,0,0,0,30.719970703125,-30.72003173828125l0,-382.9759521484375a30.72,30.72,0,0,0,-30.719970703125,-30.72003173828125Zm831.4879989624023,382.4639892578125a30.72,30.72,0,0,1,-30.719970703125,30.72003173828125L136.19200134277344,915.968017578125a30.72,30.72,0,0,1,-30.720001220703125,-30.72003173828125L105.47200012207031,563.2000122070312a30.72,30.72,0,0,1,30.720001220703125,-30.72003173828125l757.7600250244141,0a30.72,30.72,0,0,1,30.719970703125,30.72003173828125Z M147.96800231933594,546.8159790039062a30.72,30.72,0,0,0,-30.720001220703125,30.72003173828125L117.24800109863281,870.4000244140625a30.72,30.72,0,0,0,30.720001220703125,30.719970703125l733.6959991455078,0a30.72,30.72,0,0,0,30.719970703125,-30.719970703125l0,-292.864013671875a30.72,30.72,0,0,0,-30.719970703125,-30.72003173828125Zm377.34400939941406,240.12799072265625c0,6.14404296875,-13.824005126953125,11.2640380859375,-30.720001220703125,11.2640380859375L232.9600067138672,798.2080078125c-16.896011352539062,0,-30.720001220703125,-5.1199951171875,-30.720001220703125,-11.2640380859375s13.823989868164062,-11.26397705078125,30.720001220703125,-11.26397705078125l261.6320037841797,0c17.407989501953125,0,30.720001220703125,5.1199951171875,30.720001220703125,11.26397705078125Zm0,-57.343994140625c0,6.14404296875,-13.824005126953125,11.2640380859375,-30.720001220703125,11.2640380859375L232.9600067138672,740.864013671875c-16.896011352539062,0,-30.720001220703125,-5.1199951171875,-30.720001220703125,-11.2640380859375s13.823989868164062,-11.26397705078125,30.720001220703125,-11.26397705078125l261.6320037841797,0c17.407989501953125,-1.5360107421875,30.720001220703125,4.60797119140625,30.720001220703125,11.26397705078125Zm0,-57.343994140625c0,6.14404296875,-13.824005126953125,11.2640380859375,-30.720001220703125,11.2640380859375L232.9600067138672,683.52001953125c-16.896011352539062,0,-30.720001220703125,-5.1199951171875,-30.720001220703125,-11.2640380859375s13.823989868164062,-11.26397705078125,30.720001220703125,-11.26397705078125l261.6320037841797,0c17.407989501953125,-0.51202392578125,30.720001220703125,4.60797119140625,30.720001220703125,10.75201416015625Zm302.08001708984375,153.60003662109375a30.72,30.72,0,0,1,-30.72003173828125,30.719970703125l-102.4000244140625,0a30.72,30.72,0,0,1,-30.719970703125,-30.719970703125l0,-190.4639892578125a30.72,30.72,0,0,1,30.719970703125,-30.72003173828125l102.4000244140625,0a30.72,30.72,0,0,1,30.72003173828125,30.72003173828125Z",
            type: "scatter",
            coordinateSystem: "geo",
            label: {
              show: true,
              position: "right",
              distance: 5,
              fontSize: 15,
              formatter: function (param) {
                return param.data[2];
              },
            },
            symbolSize: function () {
              return 20;
            },
            hoverAnimation: true,
            itemStyle: {
              //坐标点的图形样式设置
              normal: {
                color: "#ca9f92",
                shadowBlur: 10,
                shadowColor: "#333",
              },
            },
            zlevel: 100,
            data: [],
          },
        ],
      };
      // 基于准备好的dom，初始化echarts实例
      let myChart = this.$echarts.init(document.getElementById("myChart"));
      myChart.setOption(option);
      // 更新热力图数据
      let studentData = this.student.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.studentName);
        return obj;
      });
      let floorData = this.floor.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.floorNum);
        return obj;
      });
      let mhqData = this.mhq.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.objectName);
        return obj;
      });
      let bjanData = this.bjan.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.objectName);
        return obj;
      });
      let dzData = this.dz.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.objectName);
        return obj;
      });
      let xfsData = this.xfs.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.objectName);
        return obj;
      });
      let yjdData = this.yjd.map((a) => {
        let obj = myChart.convertFromPixel("geo", [a.x, a.y]);
        obj.push(a.objectName);
        return obj;
      });
      myChart.setOption({
        series: [
          {
            type: "custom",
            data: [10],
          },
          {
            type: "scatter",
            data: studentData,
          },
          {
            type: "scatter",
            data: floorData,
          },
          {
            type: "scatter",
            data: mhqData,
          },
          {
            type: "scatter",
            data: bjanData,
          },
          {
            type: "scatter",
            data: dzData,
          },
          {
            type: "scatter",
            data: xfsData,
          },
          {
            type: "scatter",
            data: yjdData,
          },
        ],
      });
      myChart.getZr().on("click", (params) => {
        this.mapX = params.offsetX;
        this.mapY = params.offsetY;
      });
    },
    openModal(key) {
      this.currentKey = key;
      this.modalVisible = true;
    },
    handleChange(value){
      this.objectForAdd = `${value}`;
    },
    doAdd(){
      let params = {
        name: this.objectForAdd,
        floorId: this.floorname,
        x: this.mapX,
        y: this.mapY,
        type: this.objectForAdd,
        buildName: this.buildname
      };
      object(params).then((result) => {
        console.log(result);
        if(result.data.code == 200){
          this.$message.info("添加成功！");
        }
      })
    }
  },
};
</script>

<style lang="less">
@import "index";
</style>
